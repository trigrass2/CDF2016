# OBSOLETE #

__author__ = 'adrie_000'

import pygame
from time import sleep
from SerialCom import HokuyoCom, find_ports
from math import ceil
import Mapping
import Tools
import numpy as np

#ports = find_ports()
#print(ports)
#com = HokuyoCom(ports[0])
#sleep(0.2)

black = [0, 0, 0]
white = [255, 255, 255]
red = [255, 0, 0]
blue = [0, 0, 255]
green = [0, 255, 0]

pygame.init()
size = [409, 409]
screen = pygame.display.set_mode(size)
done = False
clock = pygame.time.Clock()

# Test value
X = [157.27828649473898, 170.84028468288344, 74.6012973781557, 79.95580339965247, 85.70283738606757, 91.93408427397681, 107.85887633768775, 449.33070892000745, 499.36746416134747, 524.3579753226385, 1608.8716229685779, 1619.7371083591381, 1612.477341347772, 1597.4280251446014, 1545.8609752623793, 1547.2848216010561, 1532.3626122437324, 1509.9972375600967, 1499.292041241719, 1504.7691480062604, 1513.7505871738842, 1522.6747551853978, 1531.5413144043225, 1533.0149297100618, 1520.3312618736202, 1509.5746244145519, 1507.4973785149468, 1503.748390855241, 1508.1069082365225, 1516.1583639715018, 1515.0075427099487, 1492.2545751957693, 1498.388231603449, 1502.1278180826882, 1508.1049423234585, 1515.5727965559663, 1508.0598022314139, 1515.3406458846628, 1513.048132234711, 1516.1855809953142, 1504.8206375879217, 1505.2907856892068, 1507.2609764602942, 1505.0738254759874, 1493.7862833623415, 1483.1038677251909, 1487.0130699005515, 1489.1940046453053, 1473.046946468947, 1449.9993698594783, 1453.4029310293813, 1488.6182143391934, 1481.04587855975, 1486.843603351946, 1492.5850749853723, 1498.270076237508, 1499.6210928413784, 1500.8835192425981, 1494.3017405453975, 1494.4950139384684, 1493.7267507690592, 1496.3431235242697, 1491.892869165955, 1494.3360739387288, 1493.1854180540138, 1487.5233356053761, 1487.9353607095693, 1488.2625324584053, 1483.1572513156752, 1486.8754286155372, 1487.8413510972248, 1484.231543294009, 1488.637053223994, 1492.9862421419257, 1492.741736575071, 1496.9649554335629, 1476.4929050527794, 1449.4238676926525, 1435.8938428337347, 1433.2557270283899, 1390.8695495021184, 1359.289312451315, 1344.165866203348, 1347.4852970004329, 1350.7537471132136, 1367.0439172284093, 1430.1418350560346, 1448.4338393477792, 1465.7989981890805, 1469.0371277985846, 1472.2196779385315, 1466.829453951743, 1450.9165280523373, 1445.3233308626789, 1447.2581110020567, 1443.4103425117123, 1446.1729685727519, 1439.3046681751316, 1437.143353925228, 1437.7935889458251, 1432.6059932748417, 1423.479924719551, 1410.3968703837215, 1387.5336185542026, 1358.722320422089, 1357.9108209432093, 926.402744628277, 926.7869081444207, 926.1582917485666, 927.4416664506861, 924.7796788923317, 925.9877208136324, 927.1607289666468, 925.3547943028052, 924.4891978626046, 925.5512007951812, 919.685468828281, 917.7128353232503, 918.6595029699787, 919.5714141038097, 1277.3571495347198, 1376.4936033627207, 1395.5278866037222, 1397.6883574280523, 1398.8055096598002, 1399.8697395611525, 1400.881006868094, 1398.8566365686477, 1396.775377119803, 1397.6239089002306, 1393.4394364058246, 1399.1623094810175, 1399.852120077614, 1400.4889687464142, 1401.0728313929208, 1401.6036859273065, 1398.0869780422727, 1395.5137395891666, 1389.8883988424063, 1390.2040897686122, 1388.4679498809517, 1390.6776709528876, 1388.8357797517538, 1386.9409650910904, 1365.9935398386547, 1365.9935398386547, 1365.9418589145132, 1383.836370897356, 1388.6781344022725, 1392.4664176991832, 1392.2029453973232, 1391.8868005661193, 1391.5179951665777, 1391.096543152061, 1387.6275807969773, 1386.1041045617999, 1385.5264797640807, 1383.8993893644788, 1384.2139942087842, 1384.475208437524, 1388.6647812790752, 1387.8216888049324, 1386.9260895616655, 1385.978017433327, 1379.0206157804546, 1377.9722361116756, 1376.8717223174217, 1375.7191160344712, 1376.4936033627207, 1375.2351354510797, 1373.9246369692796, 1371.5754125974975, 1370.162020514842, 1368.696789797977, 1367.1797758823611, 1366.5934901454652, 1365.9532064363784, 1367.219045357793, 1362.552756207797, 1363.7078774363663, 1366.7561400325899, 1369.73936832288, 1367.7895020408728, 1365.7878868863895, 1365.675857803499, 1363.5679777702421, 1361.4085085814247, 1362.0956076993475, 1365.614887129325, 1367.1374398187331, 1365.7116911042897, 1366.1496234910041, 1369.3983203529194, 1366.8389590608294, 1366.1358958868288, 1369.182344487472, 1368.3534493374475, 1370.3100542716518, 1367.4635877163025, 1365.5097205254115, 1365.384732636401, 1362.3750791378943, 1359.3138816158885, 1357.1372125858966, 1361.4412782233744, 1361.9323988134608, 1362.354100277679, 1363.6330959897412, 1362.063372272644, 1358.5880944407297, 1357.821215079527, 1354.2359821230616, 1356.0897550003226, 1355.124823240653, 1351.363500801727, 1353.9031434468118, 1357.2602201290233, 1363.2306590433056, 1360.995348487173, 1356.9041375588313, 1357.2320508950002, 1355.6984250307344, 1354.0967758009608, 1351.5412859778585, 1352.4544511260744, 1357.6812610827008, 1354.8997853493754, 1350.3072541660226, 1349.1475543300892, 1356.5920461662051, 1351.7914969825379, 1352.9721641616338, 1362.6442477334112, 1364.4584387233306, 1359.3519747433588, 1355.8921301203861, 1358.2882974876138, 1363.94384379308, 1359.3920559354526, 1355.6179149681748, 1359.270362216147, 1361.9674355928414, 1357.1147137676721, 1351.3816953656747, 1354.6009387887364, 1356.8762475713575, 1350.9153204407107, 1349.749781171035, 1358.1389620881785, 1356.7398833571954, 1359.2289023531293, 1359.9987142466089, 1362.228101456733, 1358.0392698219339, 1359.2475983552474, 1361.8833182095793, 1358.9574696307056, 1358.25120274845, 1352.8344865481151, 1353.4473822197529, 1347.1067063886792, 1358.8043243211064, 1359.748544947906, 1362.0436482772352, 1360.4716762537034, 1362.4705680158058, 1358.4419377143697, 1357.9666321051657, 1364.606613932818, 1363.817195682375, 1358.591573628509, 1353.992480000241, 1354.9623594421116, 1351.5466382553764, 1353.6120264887684, 1350.6308925438486, 1343.3858845857358, 1351.8472308789692, 1349.8129295735046, 1349.668112857551, 1348.0098637910562, 1353.5457824744954, 1353.5236974809357, 1346.0774409821506, 1337.8985750274992, 1345.232318194902, 1343.2481565448722, 1335.9816054911882, 1350.220052007654, 1347.0272649456626, 1339.2996222420404, 1343.2769389977707, 1351.9088334329704, 1346.1350738284166, 1337.2016515109406, 741.881728180647, 724.9674532512603, 708.0257499432877, 753.7930237030014, 731.8496734940487, 687.880738046842, 613.7151562418072, 591.9031672268353, 569.910299669647, 548.0604248330087, 499.9518890170679, 477.82872869584133, 455.3399170323075, 433.272918233275, 411.5736720474519, 390.1880344125869, 367.7148435374196, 345.995827241084, 301.49645695583234, 279.10220270427556, 256.6618031737304, 234.74770172950414, 213.12890307139628, 191.56888250686114, 169.5658367142116, 147.4978614960106, 125.83698867586426, 104.27509891300214, 82.6992474655808, 61.271702740231134, 39.92640477441519, 18.62726328189104, -2.6610501964747253, -23.928503739662904, -45.23656970205736, -66.46450341691637, -87.62765402151604, -108.83285299573521, -130.05930429942794, -151.01796642365443, -172.1969085207588, -193.36933572953677, -214.4722089958477, -235.62306579602, -256.76500804613147, -277.65530559393443, -298.7586314350793, -319.85065405866004, -340.9305754702637, -361.99759813330337, -383.3846899643561, -404.793953135375, -425.8541363891821, -447.02778117101786, -468.06104135798927, -489.36011561195426, -511.1085728688556, -532.2828141551075, -556.009114238276, -581.0833134011524, -602.2954649427829, -624.0193975728082, -646.124512921852, -666.7433937155084, -688.8713424167291, -712.8546281033399, -734.2708885864773, -755.4570256374978, -776.6145807691379, -797.7427535076221, -818.8407444908297, -844.1978632167428, -869.2494768953204, -1440.016965072019, -1437.279926062404, -1208.0181614149533, -1224.6773578555176, -1241.2902199205646]
Y = [2347.737749536195, 2334.757931163201, 940.0444917287139, 934.5860417867989, 934.0765619926331, 938.5079243931324, 1035.3972487867502, 4070.273567467111, 4064.438108242893, 4061.2896613902763, 1771.4347577053054, 1761.5052369505966, 1710.8821770186341, 1674.1623889224782, 1600.2933622185794, 1582.1753002884943, 1547.7560610760227, 1506.518284841202, 1477.5480956873246, 1464.8105035152203, 1455.527107212614, 1446.1886425778237, 1436.7954629218036, 1420.5510287511865, 1391.5149493159483, 1364.7012322569599, 1346.0656201577108, 1326.1846692675472, 1313.6261086508891, 1304.325042065535, 1287.2047799522663, 1252.1502636693785, 1241.6717389842975, 1229.2652350661112, 1218.7454545308292, 1209.4461948923265, 1188.3415472387342, 1179.0431404023573, 1162.38949992722, 1150.0392532352544, 1126.9049865403385, 1112.8718032725828, 1100.054702657991, 1084.3328731838196, 1062.3048242564478, 1041.0316601999093, 1030.181115117598, 1018.1931135734901, 993.9123168059198, 965.4355635707211, 954.8512554713451, 964.9309881735543, 947.1362655928544, 938.0085816086126, 928.8454090595002, 919.6470946244826, 907.8246405034563, 896.0204582853863, 879.6694312086761, 867.4495105267262, 854.7639405338231, 844.0860481500877, 829.5207453293584, 818.88686527834, 806.353711041786, 791.5171040662709, 780.0310008904029, 768.5698631097201, 754.4140559863201, 744.8291480462902, 733.8999345722716, 720.8028342695973, 711.6598371192404, 702.4899150699113, 691.192525919401, 681.997743547434, 661.73461548328, 638.926014310634, 622.4418624354972, 610.853518398905, 582.7056686422177, 559.6718369327075, 543.799709574953, 535.5215909444319, 527.2232114196155, 523.915001091595, 538.0319057663384, 534.7666902792764, 530.9560216325716, 521.9299925749475, 512.8842168468108, 500.91052396573906, 485.53190278760326, 473.79475436523256, 464.5900990537342, 453.5808451976576, 444.6939902556301, 432.91000469990774, 422.6381197532314, 413.23794064229304, 402.22390286133475, 390.2318591817197, 377.33362957971804, 362.08625682547097, 345.65540063307805, 336.5697585424746, 223.57762577054876, 217.646564163336, 211.49661610857254, 205.7959069835313, 199.24493847472237, 193.55294082595134, 187.85362030590736, 181.56955873937952, 175.50134767390838, 169.81158590213514, 162.89456229753293, 156.72955012683738, 151.08182419785578, 145.42838224748184, 193.96575092664045, 200.36556565815644, 194.3782850818191, 185.92271380891896, 177.32215356628905, 168.71488452709502, 160.10123233827804, 151.15922177575035, 142.2481840721786, 133.65406567119538, 124.60953843513684, 116.45098422832558, 107.84267204687407, 99.23027975172329, 90.61413318364957, 81.99455832546565, 73.16284459085902, 64.42361847847319, 55.59890973114248, 47.04879159579373, 38.44154202665405, 29.943538752989554, 21.35829771629368, 12.796849307317114, 4.201085462296902, -4.201085462296902, -12.603097443255962, -21.281413995213327, -29.900485498132632, -38.55224481146865, -47.11643903158926, -55.678850650958445, -64.23915571976603, -72.79703036790534, -81.17694876951371, -89.64603347014966, -98.17012719027387, -106.61369572725158, -115.206849781443, -123.8079045209729, -132.79730883996976, -141.33633673838258, -149.87001732563797, -158.39802773893464, -166.20210965116019, -174.68118532168475, -183.15365211389283, -191.6191894809425, -200.36556565815738, -208.82845165553968, -217.2834368488158, -225.56792227177237, -234.00008021085313, -242.42338500382309, -250.83751796383402, -259.4286659026643, -268.02208458665564, -277.0145880832361, -284.80517297011147, -293.8125678353467, -303.2781787125733, -312.79236382373125, -321.21157841332706, -329.6186403018059, -338.4943890416459, -346.8881231745655, -355.2687331613931, -364.41124500507016, -374.3687754751463, -383.84270299939266, -392.5207978961893, -401.7601351993347, -411.88377027336566, -420.2990126011577, -429.29793147590624, -439.52668581530935, -448.5630810558415, -458.55790818829263, -466.9778755680599, -475.7091581529752, -485.103630045606, -493.49280009339134, -501.8632993618345, -510.566926283502, -521.7678084641714, -531.5864379968815, -541.4307947065776, -551.6754295067285, -560.8140243550195, -569.1813328315561, -578.7033332200159, -587.0442101947576, -597.7830512679037, -607.339866497325, -615.6636165154647, -626.9053183414877, -638.6271955181015, -651.7078872043477, -660.9543565150916, -669.3132013308303, -679.8861375431563, -689.5815980499959, -699.2838635099788, -708.5281591421166, -719.6464115308771, -733.178418466397, -742.4766472153965, -750.7964566689272, -761.0531365451029, -776.2905514551807, -784.6201301812933, -796.4711689721009, -813.4922581801537, -826.0013129509489, -834.378336704238, -843.7804995836309, -856.9065882044549, -872.248927187049, -881.1658403839672, -890.608819076781, -905.0265644724383, -918.9633857693457, -927.8877376467958, -936.2176634899573, -950.8318971472686, -964.9413706421091, -973.2691287606792, -985.0972176535385, -1004.0814507090774, -1016.0127405244011, -1030.986319505699, -1044.8102685404517, -1059.910656424203, -1070.1263204040486, -1084.696716306218, -1100.5793145350615, -1112.1018819042208, -1125.5441662735361, -1135.1629187064286, -1149.9374694140974, -1158.8927998752279, -1183.5771238944512, -1199.1884316120018, -1216.1879378564975, -1229.9076461716297, -1247.0296513277813, -1258.7849307402867, -1273.9586437906662, -1296.0604882530788, -1311.3606127839369, -1322.514626030885, -1334.3557861765344, -1351.8405987745248, -1365.123688396253, -1384.1352830359358, -1398.18889714738, -1407.9170306150147, -1434.3465635490131, -1449.9538113871743, -1467.798346209566, -1484.2150811530041, -1508.8548024066154, -1527.6303873507939, -1538.1844892206348, -1547.9481266952673, -1575.9232246794163, -1593.3425212234818, -1604.6486063276243, -1642.1881168600778, -1659.0016719379782, -1670.3764611195668, -1696.6151788654902, -1729.2679104424235, -1743.883414397007, -1754.5163844194824, -2747.603956430347, -2752.115221375439, -2756.5223629452466, -3565.1833161026498, -3569.752380124797, -3578.485166969975, -3544.257708886177, -3547.9655636190782, -3550.551823355132, -3553.990119672797, -3529.7695546123496, -3529.8050521286464, -3526.726748694462, -3526.483174258119, -3529.08148283337, -3534.528157732124, -3529.8989778522346, -3532.093980563337, -3524.12668422165, -3516.9427007623567, -3507.6222314826905, -3504.145761313692, -3504.525227570146, -3505.76986741216, -3497.892426450449, -3485.8808615404664, -3480.7260811906744, -3476.4364949969504, -3469.01438948711, -3464.458222932312, -3461.7697615817533, -3460.9498732374946, -3460.998977002428, -3457.9172093485377, -3460.704357896177, -3457.361200364455, -3452.8882684284304, -3451.2844580110764, -3450.549750020299, -3443.6902552083957, -3442.6962144075233, -3441.571922828218, -3439.3193616714984, -3437.9351027709768, -3436.420773223656, -3431.786201277046, -3430.0134518895165, -3428.110931562491, -3426.078712275816, -3423.916870916366, -3424.606864955587, -3425.1631866971006, -3422.608545323322, -3420.915983017022, -3418.101645879314, -3417.137790205167, -3419.008193429779, -3416.787819832411, -3430.230147509634, -3450.412030886563, -3446.772573424211, -3445.9546995648197, -3446.9656386163033, -3439.9809951417938, -3440.717552138939, -3450.125690346896, -3446.653777531829, -3442.072149507466, -3437.360294315505, -3432.518390224017, -3427.5466204213335, -3439.9264480131383, -3450.1839584168856, -3343.0451896893005, -3280.998386792967, -2712.1307346239114, -2704.6490288309183, -2697.0649954959476]

while not done:
    # Endle close window envent
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            done = True

    # Get new data from lidar
    #[ranging, angles] = com.get_fresh_data()

    # Save data into a file
    #print([ranging, angles])
    #f = open('lidar.raw', 'w')
    #f.write(str(ranging) + str(angles))
    #f.close()

    # Reset display
    screen.fill(white)
    #pygame.draw.circle(screen, green, [204, 204], 205)

    #Process data
    #[r2, ang2] = com.clean_data(ranging, angles)
    #[X, Y] = Tools.polar2cartesian(r2, ang2)
    X = np.array(X)
    Y = np.array(Y)

    # Find obstacles
    raw_obstacles = Mapping.find_obstacles([X, Y])

    print(len(raw_obstacles), " obstacles extracted.")

    for k in range(len(X)):
        pygame.draw.circle(screen, red, [int(ceil(X[k]/20.0))+204, int(ceil(Y[k]/20.0))+204], 1)
    pygame.display.flip()
    clock.tick(60)
pygame.quit()
com.com.close()